
@{
    Layout = "~/Views/Shared/_AdminLteLayout.cshtml";
}

<div class="box box-primary box-body" ng-controller="workflowDocSearchingCtrl">
    <div class="box-header with-border">
        <div class="row">
            <div class="col-lg-6">
                <i class="fa  fa-table"></i>
                <h3 class="box-title">Search Workflow Document</h3>

            </div>
            <div class="col-lg-6">
                <button type="button" id="btnRefresh" data-ng-click="toggleRefreshTable()" class="btn btn-default btn-flat pull-right" ng-disabled="loading"><i class="fa fa-refresh"></i> Refresh</button>
            </div>
        </div>

    </div>

    <div class="box-body">
        <div class="row">
            <div class="col-sm-2 col-md-2 col-lg-2">
                <div class="form-group">
                    <label>Owner Level</label>
                </div>
            </div>
            <div class="col-sm-4 col-md-4 col-lg-4">
                <div class="form-group">
                    <select class="form-control" ng-model="docPropIdentityModel.OwnerLevel"
                            ng-options="ownerLevel as ownerLevel.LevelName for ownerLevel in ownerLevels
                        track by ownerLevel.OwnerLevelID">
                        <option value="">--Select--</option>
                    </select>
                </div>
            </div>

            <div class="col-sm-2 col-md-2 col-lg-2">
                <div class="form-group">
                    <label>Owner</label>
                </div>
            </div>
            <div class="col-sm-4 col-md-4 col-lg-4">
                <div class="form-group">
                    <select class="form-control" ng-model="docPropIdentityModel.Owner"
                            data-ng-options="owner as owner.OwnerName for owner in ownersForSpecificOwnerLevel track by owner.OwnerID"
                            data-ng-disabled="!docPropIdentityModel.OwnerLevel">
                        <option value="">--Select--</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-2 col-md-2 col-lg-2">
                <div class="form-group">
                    <label>Document Category</label>
                </div>
            </div>
            <div class="col-sm-4 col-md-4 col-lg-4">
                <div class="form-group">
                    <select class="form-control" data-ng-model="docPropIdentityModel.DocCategory"
                            data-ng-options="docCategory as docCategory.DocCategoryName for docCategory in
                         docCategoriesForSpecificOwner track by docCategory.DocCategoryID"
                            data-ng-disabled="!docPropIdentityModel.Owner">
                        <option value="">--Select--</option>
                    </select>
                </div>
            </div>

            <div class="col-sm-2 col-md-2 col-lg-2">
                <div class="form-group">
                    <label>Document Type</label>
                </div>
            </div>
            <div class="col-sm-4 col-md-4 col-lg-4">
                <div class="form-group">
                    <select class="form-control" data-ng-model="docPropIdentityModel.DocType"
                            data-ng-options="docType as docType.DocTypeName for docType in
                         docTypeForSpecificDocCategory track by docType.DocTypeID"
                            data-ng-disabled="!docPropIdentityModel.DocCategory">
                        <option value="">--Select--</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div ng-bind-html="tableData" style="overflow-y:scroll;" compile-template></div>
    <div ng-if="pagingInfo.totalItems > 0 " class="text-center">
        <ul uib-pagination total-items="pagingInfo.totalItems" ng-model="pagingInfo.page" items-per-page="pagingInfo.itemsPerPage" max-size="7" boundary-links="true" rotate="true" force-ellipses="true" ng-change="selectPage()"></ul>
    </div>

    <div id="DetailViewModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                    <h4 class="modal-title">Associated Documents</h4>
                </div>
                <div class="modal-body">
                    <table class="table table-condensed table-bordered table-hover pnlView">
                        <thead>
                            <tr>
                                <th>
                                    Index
                                </th>

                                <th>
                                    Document of
                                </th>
                                <th>
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat-start="item in Documents">
                                <td>
                                    {{$index+1}}
                                </td>

                                <td>
                                    {{item.DocPropertyName}}
                                </td>
                                <td>
                                    <button type="button" class="btn btn-info btn-xs" data-toggle="collapse" data-target="#showqview_{{$index}}" ng-click="QuickView(item,$index)"><i class="fa fa-search-plus"></i> Quick View</button>
                                    @*<button type="button" class="btn btn-info btn-xs" ng-click="LargeViewView(item)">Large View</button>*@
                                </td>
                            </tr>
                            <tr style="margin-top:0px;padding-top:0px;margin-bottom:0px;padding-bottom:0px" ng-repeat-end>
                                <td colspan="3" style="margin-top:0px;padding-top:0px;margin-bottom:0px;padding-bottom:0px">
                                    <div class="box box-success collapse" style="margin:0px;padding:0px" id="showqview_{{$index}}">
                                        <div class="box-header with-border" style="margin:0px;padding:0px">
                                            <h3 class="box-title">Quick Viewer</h3>
                                            <div class="box-tools pull-right">

                                                <button class="btn btn-secondary btn-box-tool" ng-click="Print()"> <span class="glyphicon glyphicon-print"></span> Print</button>
                                            </div>
                                        </div>
                                        <div id="q_view_loader_{{$index}}" style="margin:0px;padding:0px"></div>

                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <div id="viewerModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="modal-title">Image Viewer</h3>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <button type="button" class="btn btn-danger btn-sm btn-flat pull-right" ng-click="CloseModalView('viewerModal')"><span class="glyphicon glyphicon-remove"></span> Close</button>


                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="box-body">
                        <div id="dwtLargeViewer" class="box-body"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!--<div class="box-body hidden" id="q-view-body">
          <div id="dwtQuickViewer" class="box-body"></div>
      </div> -->

      <div id="mydiv" data-ng-show="loading">
          <div class="overlay">
              <div class="loder">
                  <img src="~/Content/AdminLTE/img/cube.gif" /> <span class="text-bold">Loading...</span>
              </div>
          </div>
      </div>

      <!--<div id="ConfirmDelete" class="modal fade" role="dialog">
          <div class="modal-dialog modal-sm">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">Are You Sure?</h4>
                  </div>
                  <div class="modal-body">
                      <div class="box-body">
                          <div class="form-group">
                              <input type="hidden" ng-model="DocumentIDForDelete" />
                              <h4>You Want to Delete the Document?</h4>
                          </div>
                      </div>-->
    <!-- /.box-body -->
    <!--</div>
                <div class="modal-footer">
                    <button type="button" id="yes" class="btn btn-danger" ng-disabled="loading" data-ng-click="DeleteDocument()">Yes</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
                </div>
            </div>
        </div>
    </div>-->
</div>


    <script type="text/javascript" src="~/NgScripts/Controller/WorkflowDocumentSearchingCtr.js"></script>
    <script type="text/javascript" src="~/NgScripts/Services/ImageProcessServices.js"></script>
    <script type="text/javascript" src="~/NgScripts/Base/environmentServices.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf_viewer.min.css" rel="stylesheet" type="text/css" />


<script type="text/javascript">

    ////app.controller('workflowDocSearchingCtrl', function ($scope, $http, $sce) {
    ////    //applySecurity();
    ////    $scope.docPropIdentityModel = {
    ////        OwnerLevel: { OwnerLevelID: "", LevelName: "" },
    ////        Owner: { OwnerID: "", OwnerName: "" },
    ////        DocCategory: { DocCategoryID: "", DocCategoryName: "" },
    ////        DocType: { DocTypeID: "", DocTypeName: "" },
    ////        DocProperty: { DocPropertyID: "", DocPropertyName: "" },
    ////        SearchBy: 1,
    ////        SearchFor: "",
    ////        Status: ""
    ////    };

    ////    $scope.pagingInfo = {
    ////        page: 1,
    ////        itemsPerPage: 20,
    ////        sortBy: null,
    ////        reverse: false,
    ////        search: null,
    ////        totalItems: 0
    ////    };


    ////    $scope.search = function (keyEvent) {
    ////        if (keyEvent.which === 13)
    ////        {
    ////            $scope.pagingInfo.page = 1;
    ////            $scope.BindDataToGrid();
    ////        }
    ////    };


    ////    $scope.sort = function (sortBy) {
    ////        if (sortBy === $scope.pagingInfo.sortBy) {
    ////            $scope.pagingInfo.reverse = !$scope.pagingInfo.reverse;
    ////        } else {
    ////            $scope.pagingInfo.sortBy = sortBy;
    ////            $scope.pagingInfo.reverse = false;
    ////        }
    ////        $scope.pagingInfo.page = 1;
    ////        $scope.BindDataToGrid();
    ////    };

    ////    $scope.selectPage = function () {
    ////        $scope.BindDataToGrid();
    ////    };


    ////    Dynamsoft.WebTwainEnv.RegisterEvent('OnWebTwainReady', Dynamsoft_OnReady);

    ////    var DWObject;
    ////    var DWObjectLargeViewer;
    ////    var DWObjectQuickViewer;
    ////    var zoomFactor = .5;

    ////    function Dynamsoft_OnReady() {
    ////        DWObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtVerticalThumbnil');

    ////        DWObjectQuickViewer = Dynamsoft.WebTwainEnv.GetWebTwain('dwtQuickViewer');

    ////        DWObjectLargeViewer = Dynamsoft.WebTwainEnv.GetWebTwain('dwtLargeViewer');



    ////        DWObjectQuickViewer.SetViewMode(1, 1);

    ////        DWObjectQuickViewer.Width = 9.69 * 100;
    ////        DWObjectQuickViewer.Height = 10.69 * 70;

    ////        DWObjectLargeViewer.SetViewMode(-1, -1);
    ////        DWObjectLargeViewer.MaxImagesInBuffer = 1;
    ////        DWObjectLargeViewer.Width = 9.69 * 90;

    ////        DWObject.SetViewMode(-1, 4);
    ////        DWObject.FitWindowType = 0;
    ////        DWObject.SelectionImageBorderColor = 0x691254;
    ////        DWObject.ShowPageNumber = true;
    ////        DWObject.IfAppendImage = true;

    ////        DWObject.RegisterEvent('OnMouseClick', $scope.updateLargeViewer);

    ////    };

    ////    $scope.ResetImageViewrs = function () {
    ////        DWObjectQuickViewer.RemoveAllImages();
    ////        DWObject.RemoveAllImages();
    ////        DWObjectLargeViewer.RemoveAllImages();

    ////    }

    ////    $scope.ZoomIn = function () {
    ////        DWObjectLargeViewer.Zoom = zoomFactor * 1.2;
    ////        zoomFactor = zoomFactor * 1.2;
    ////    };

    ////    $scope.ZoomOut = function () {
    ////        DWObjectLargeViewer.Zoom = zoomFactor / 1.2;
    ////        zoomFactor = zoomFactor / 1.2;
    ////    };

    ////    $scope.RotateRight = function () {
    ////        DWObjectLargeViewer.RotateRight(DWObjectLargeViewer.GetSelectedImageIndex(0));
    ////    }

    ////    var preIndex = -1;

    ////    $scope.QuickView = function (item,index) {
    ////        $("#dwtQuickViewer").appendTo("#q_view_loader_"+index+"");
    ////        DWObjectQuickViewer.IfShowFileDialog = false;
    ////        DWObjectQuickViewer.RemoveAllImages();

    ////        DWObjectQuickViewer.FTPPort = item.ServerPort;
    ////        DWObjectQuickViewer.FTPUserName = item.FtpUserName;
    ////        DWObjectQuickViewer.FTPPassword = item.FtpPassword;

    ////        DWObjectQuickViewer.FTPDownload(item.ServerIP, (item.FileServerURL +
    ////            "//" + item.DocumentID + ".pdf"));

    ////        if (preIndex != -1)
    ////        {
    ////            $("#showqview_" + preIndex + "").collapse("hide");
    ////        }

    ////        preIndex = index;
    ////    };

    ////    $("#DetailViewModal").on("hidden.bs.modal", function () {
    ////        $("#dwtQuickViewer").appendTo("#q-view-body");
    ////    });

    ////    $scope.Print = function() {
    ////        DWObjectQuickViewer.Print();
    ////    };

    ////    $scope.DetailPrint = function () {
    ////        DWObject.Print();
    ////    };


    ////    $scope.LargeViewView = function (tableRow) {
    ////        DWObject.IfShowFileDialog = false;
    ////        DWObject.RemoveAllImages();
    ////        DWObjectLargeViewer.RemoveAllImages();
    ////        DWObject.FTPPort = tableRow.ServerPort;
    ////        DWObject.FTPUserName = tableRow.FtpUserName;
    ////        DWObject.FTPPassword = tableRow.FtpPassword;
    ////        DWObject.FTPDownload(tableRow.ServerIP, (tableRow.FileServerURL + "//" +
    ////            tableRow.DocumentID + ".pdf"));

    ////        $('#LargeViewModal').modal('show');
    ////    };

    ////    $scope.updateLargeViewer = function () {
    ////        DWObject.CopyToClipboard(DWObject.CurrentImageIndexInBuffer);
    ////        DWObjectLargeViewer.LoadDibFromClipboard();
    ////    };


    ////    $scope.loading = true;


    ////    $http.get('/DocScanningModule/OwnerProperIdentity/GetOwnerLevel?_OwnerLevelID=')
    ////        .success(function (response) {
    ////            $scope.ownerLevels = response.result;
    ////            $scope.docPropIdentityModel.OwnerLevel = "";
    ////            $scope.loading = false;
    ////        })
    ////        .error(function () {
    ////            $scope.loading = false;
    ////        });


    ////    $scope.$watch('docPropIdentityModel.OwnerLevel', function (newVal) {
    ////        if (newVal) {
    ////            $scope.docPropIdentityModel.Owner = "";
    ////            $scope.docPropIdentityModel.DocCategory = "";
    ////            $scope.docPropIdentityModel.DocType = "";
    ////            $scope.docPropIdentityModel.DocProperty = "";
    ////            $http.post('/DocScanningModule/OwnerProperIdentity/GetOwnerForSpecificOwnerLevel',
    ////                { _OwnerLevelID: $scope.docPropIdentityModel.OwnerLevel.OwnerLevelID })
    ////                .success(function (response) {
    ////                    $scope.ownersForSpecificOwnerLevel = response.result;
    ////                    $scope.loading = false;
    ////                }).error(function () {
    ////                    $scope.loading = false;
    ////                });
    ////        }
    ////    });

    ////    $scope.$watch('docPropIdentityModel.Owner', function (newVal) {
    ////        if (newVal) {
    ////            $scope.docPropIdentityModel.DocCategory = "";
    ////            $scope.docPropIdentityModel.DocType = "";
    ////            $scope.docPropIdentityModel.DocProperty = "";
    ////            $http.post('/DocScanningModule/OwnerProperIdentity/GetDocumentCategoriesForSpecificOwner',
    ////                { _OwnerID: $scope.docPropIdentityModel.Owner.OwnerID })
    ////                .success(function (response) {
    ////                    $scope.docCategoriesForSpecificOwner = response.result;
    ////                    $scope.loading = false;
    ////                }).error(function () {
    ////                    $scope.loading = false;
    ////                });
    ////        }
    ////    });

    ////    $scope.$watch('docPropIdentityModel.DocCategory', function (newVal) {
    ////        if (newVal) {
    ////            $scope.docPropIdentityModel.DocType = "";
    ////            $scope.docPropIdentityModel.DocProperty = "";
    ////            $http.post('/DocScanningModule/OwnerProperIdentity/GetDocumentTypeForSpecificDocCategory',
    ////                {
    ////                    _DocCategoryID: $scope.docPropIdentityModel.DocCategory.DocCategoryID,
    ////                    _OwnerID: $scope.docPropIdentityModel.Owner.OwnerID
    ////                })
    ////                .success(function (response) {
    ////                    $scope.docTypeForSpecificDocCategory = response.result;
    ////                    $scope.loading = false;
    ////                }).error(function () {
    ////                    $scope.loading = false;
    ////                });
    ////        }
    ////    });

    ////    $scope.$watch('docPropIdentityModel.DocType', function (newVal) {
    ////        if (newVal) {
    ////            $scope.docPropIdentityModel.DocProperty = "";
    ////            $scope.BindDataToGrid();
    ////        }
    ////    });


    ////    $scope.BindDataToGrid = function ()
    ////    {
    ////        $scope.loading = true;
    ////        $scope.tableData = '';

    ////        $http.post('/WorkflowModule/WorkflowDocSearching/GetDocumentsBySearchParam',
    ////        {
    ////            _DocCategoryID: $scope.docPropIdentityModel.DocCategory.DocCategoryID,
    ////            _OwnerID: $scope.docPropIdentityModel.Owner.OwnerID,
    ////            _DocTypeID: $scope.docPropIdentityModel.DocType.DocTypeID,
    ////            page: $scope.pagingInfo.page,
    ////            itemsPerPage: $scope.pagingInfo.itemsPerPage,
    ////            sortBy: '[ObjectID]',
    ////            reverse: $scope.pagingInfo.reverse,
    ////            search: $scope.pagingInfo.search
    ////        })
    ////        .success(function (pageable) {
    ////            $scope.tableData = $sce.trustAsHtml(pageable.html);
    ////            $scope.pagingInfo.totalItems = pageable.totalPages;
    ////            $scope.loading = false;
    ////        }).error(function () {
    ////            $scope.loading = false;
    ////        });
    ////    };

    ////    $scope.Documents = [];

    ////    $scope.viewDetail = function (id) {
    ////        $http.get('/WorkflowModule/WorkflowDocSearching/GetDocumentForSpecificObject?_ObjectID=' + id)
    ////      .success(function (response) {
    ////          $('#DetailViewModal').modal('show');
    ////          $scope.Documents = response;
    ////          $scope.loading = false;
    ////      })
    ////      .error(function () {
    ////          $scope.loading = false;
    ////      });
    ////    };
    ////    $scope.toggleRefreshTable = function (row) {
    ////        location.reload();
    ////    };
    ////});
</script>

<script type="text/javascript">
    //$('.modal').on('hidden.bs.modal', function (e) {
    //    if ($('.modal').hasClass('in')) {
    //        $('body').addClass('modal-open');
    //    }
    //});
</script>

